<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estudo Social Master v16</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --preto: #000000; --azul-profundo: #001a33; --azul-brilhante: #1DA1F2;
            --msg-out: #005c4b; --msg-in: #202c33; --ouro: #ffd700; --vermelho: #ff3b3b;
            --fundador: #eb4034; --adm: #25d366;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--preto); color: white; margin: 0; overflow: hidden; }

        /* ANIMA√á√ïES E EFEITOS */
        @keyframes fogoAzul { from { text-shadow: 0 0 5px #00f, 0 0 10px #0ff; } to { text-shadow: 0 0 10px #0ff, 0 0 20px #00f; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        
        .premium-tag { animation: fogoAzul 1s infinite alternate; color: var(--ouro); }
        .linha-movimentada { background: linear-gradient(90deg, transparent, var(--ouro), transparent); background-size: 200% 100%; animation: movimentoLinha 2s linear infinite; }
        .msg-efeito { animation: bounce 0.5s ease; }

        /* COMPONENTES */
        .win { display: none; position: fixed; inset: 0; background: var(--preto); flex-direction: column; z-index: 2000; }
        .win-small { height: 85%; top: 7.5%; border-radius: 20px; border: 1px solid #333; overflow-y: auto; }
        
        .botao-flutuante { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--azul-brilhante); color: white; border-radius: 50%; border: none; font-size: 30px; cursor: pointer; z-index: 9999; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        
        .menu-opcoes { position: fixed; bottom: 100px; right: 30px; display: none; flex-direction: column; gap: 10px; z-index: 9999; }
        .opcao-item { background: #1a1a1a; color: white; border: 1px solid var(--azul-brilhante); padding: 12px 20px; border-radius: 25px; cursor: pointer; }

        /* CHAT ESTILO WHATSAPP */
        #chat-messages { flex:1; overflow-y: auto; padding: 20px; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-color: #0b141a; display: flex; flex-direction: column; }
        .bubble { max-width: 80%; padding: 8px 12px; border-radius: 10px; margin-bottom: 5px; position: relative; font-size: 14px; }
        .out { align-self: flex-end; background: var(--msg-out); }
        .in { align-self: flex-start; background: var(--msg-in); }
        .time { font-size: 10px; color: rgba(255,255,255,0.5); float: right; margin-top: 5px; margin-left: 8px; }
        .badge { font-size: 10px; padding: 2px 5px; border-radius: 4px; margin-right: 5px; font-weight: bold; }
        
        /* AUDIO */
        .audio-player { display: flex; align-items: center; gap: 10px; min-width: 150px; }

        .janela-grupo { display: none; width: 320px; top: 50%; left: 50%; transform: translate(-50%, -50%); position: fixed; z-index: 10000; background: #121212; border: 2px solid var(--azul-brilhante); border-radius: 20px; padding: 25px; }
    </style>
</head>
<body onload="initApp()">

    <div id="screen-home" style="padding: 20px; height: 100vh; overflow-y: auto;">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h1 style="margin:0; font-size:22px; color:var(--azul-brilhante)">Estudo Social Master</h1>
            <div id="g_id_onload" data-client_id="YOUR_GOOGLE_CLIENT_ID" data-callback="handleCredentialResponse"></div>
            <div class="g_id_signin" data-type="standard"></div>
        </div>

        <div id="user-info-bar" style="margin-top:15px; display:flex; align-items:center; gap:10px;">
            <img id="top-pfp" src="https://via.placeholder.com/40" style="width:40px; height:40px; border-radius:50%;" onclick="openWin('win-profile')">
            <div>
                <b id="top-username">Usu√°rio #000</b><br>
                <small id="user-id-display">ID: ---</small>
            </div>
        </div>

        <h3 style="color:var(--azul-brilhante)">Grupos Dispon√≠veis</h3>
        <div id="group-list">
            </div>
    </div>

    <div id="win-profile" class="win win-small">
        <button class="btn-v" onclick="closeWin('win-profile')">X</button>
        <div id="p-banner" style="width:100%; height:100px; background:#111;"></div>
        <center>
            <img id="p-img" src="https://via.placeholder.com/90" style="width:90px; height:90px; border-radius:50%; margin-top:-45px; border:3px solid var(--preto);">
            <h2 id="p-name">@Usuario</h2>
            <p id="p-id-detail">ID: 0</p>
            <button onclick="buyPremium()" style="background:var(--ouro); border:none; padding:10px; border-radius:5px; font-weight:bold;">VIRE PREMIUM üëë</button>
        </center>
    </div>

    <div id="janelaCriar" class="janela-grupo">
        <button onclick="fecharJanelaGrupo()" style="float:right; background:none; border:none; color:white;">X</button>
        <h3>Novo Grupo</h3>
        <center>
            <div onclick="document.getElementById('in-foto-grupo').click()" style="width:80px; height:80px; border-radius:50%; background:#222; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden;">
                <img id="prev-grupo" style="width:100%; height:100%; display:none;">
                <span>üì∑</span>
            </div>
            <input type="file" id="in-foto-grupo" hidden onchange="previewFotoGrupo(this)">
            <input type="text" id="nome-grupo-input" placeholder="Nome do Grupo" style="width:80%; margin-top:15px; padding:10px; border-radius:8px; border:1px solid #333; background:#000; color:white;">
        </center>
        <button class="btn-check-azul" onclick="finalizarCriacaoGrupo()">‚úÖ</button>
    </div>

    <div id="win-chat" class="win">
        <div style="background: #1a1a1a; padding: 10px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #333;">
            <button onclick="closeWin('win-chat')" style="background:none; border:none; color:white; font-size:20px;">‚Üê</button>
            <img id="chat-icon" src="" style="width:40px; height:40px; border-radius:50%;" onclick="openGroupSettings()">
            <div onclick="openGroupSettings()" style="flex:1; cursor:pointer;">
                <b id="chat-name">Grupo</b><br>
                <small id="chat-status" style="color:#25d366;">online</small>
            </div>
        </div>

        <div id="chat-messages"></div>

        <div style="padding: 10px; background: #1a1a1a; display: flex; align-items: center; gap: 10px;">
            <button onclick="document.getElementById('in-chat-file').click()" style="background:none; border:none; font-size:20px; color:white;">üìé</button>
            <input type="file" id="in-chat-file" hidden onchange="sendImage(this)">
            <input type="text" id="msg-input" placeholder="Mensagem" style="flex:1; padding:10px; border-radius:20px; border:none; background:#333; color:white;">
            <button id="btn-audio" onmousedown="startRecording()" onmouseup="stopRecording()" style="background:none; border:none; font-size:20px; color:white;">üé§</button>
            <button onclick="sendMessage()" style="background:var(--azul-brilhante); border:none; width:40px; height:40px; border-radius:50%; color:white;">‚û§</button>
        </div>
    </div>

    <div id="menuPrincipal" class="menu-opcoes">
        <div class="opcao-item" onclick="abrirJanelaGrupo()">üë• Criar Grupo</div>
        <div class="opcao-item" onclick="openWin('win-profile'); toggleMenuGeral()">‚öôÔ∏è Configura√ß√µes</div>
    </div>
    <button id="btnPrincipal" class="botao-flutuante" onclick="toggleMenuGeral()">+</button>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let userId = Math.floor(Math.random() * 1000000) + 1;
        let isFundador = false;

        function initApp() {
            document.getElementById('user-id-display').innerText = "ID: " + userId;
            document.getElementById('p-id-detail').innerText = "ID: " + userId;
            renderGroups();
        }

        // --- L√ìGICA DO CHAT ---
        function sendMessage() {
            const input = document.getElementById('msg-input');
            if (input.value.trim() === "") return;
            appendMessage(input.value, 'out');
            input.value = "";
        }

        function appendMessage(content, type, isAudio = false, isImg = false) {
            const container = document.getElementById('chat-messages');
            const now = new Date();
            const time = now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');
            
            let badge = isFundador ? '<span class="badge" style="background:var(--fundador)">#27</span>' : '';
            
            const div = document.createElement('div');
            div.className = `bubble ${type} msg-efeito`;
            
            if(isAudio) {
                div.innerHTML = `${badge}<div class="audio-player"><button onclick="this.nextSibling.play()">‚ñ∂Ô∏è</button><audio src="${content}"></audio></div><span class="time">${time}</span>`;
            } else if(isImg) {
                div.innerHTML = `${badge}<img src="${content}" style="max-width:200px; border-radius:10px;"><br><span class="time">${time}</span>`;
            } else {
                div.innerHTML = `${badge}${content}<span class="time">${time}</span>`;
            }

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // --- GRAVA√á√ÉO DE √ÅUDIO ---
        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();
                audioChunks = [];
                document.getElementById('btn-audio').style.color = "red";
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            });
        }

        function stopRecording() {
            if(!mediaRecorder) return;
            mediaRecorder.stop();
            document.getElementById('btn-audio').style.color = "white";
            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                const audioUrl = URL.createObjectURL(audioBlob);
                appendMessage(audioUrl, 'out', true);
            };
        }

        // --- FOTOS DA GALERIA ---
        function sendImage(input) {
            if(input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => appendMessage(e.target.result, 'out', false, true);
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- LOGIN GOOGLE ---
        function handleCredentialResponse(response) {
            const data = JSON.parse(atob(response.credential.split('.')[1]));
            document.getElementById('top-username').innerText = data.name;
            document.getElementById('top-pfp').src = data.picture;
            document.getElementById('p-name').innerText = data.name;
            document.getElementById('p-img').src = data.picture;
        }

        // --- CRIA√á√ÉO DE GRUPO ---
        function abrirJanelaGrupo() { 
            document.getElementById('janelaCriar').style.display = 'block';
            toggleMenuGeral();
        }
        function fecharJanelaGrupo() { document.getElementById('janelaCriar').style.display = 'none'; }

        function previewFotoGrupo(input) {
            if(input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('prev-grupo').src = e.target.result;
                    document.getElementById('prev-grupo').style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function finalizarCriacaoGrupo() {
            const nome = document.getElementById('nome-grupo-input').value;
            if(!nome) return alert("D√™ um nome!");
            isFundador = true; // Criador ganha #27
            document.getElementById('chat-name').innerText = nome;
            document.getElementById('chat-icon').src = document.getElementById('prev-grupo').src || '';
            document.getElementById('chat-icon').style.display = 'block';
            fecharJanelaGrupo();
            openWin('win-chat');
        }

        function openGroupSettings() {
            alert("Configura√ß√µes do Grupo:\n- Dar ADM (#99)\n- Mudar Nome\n- Apagar Grupo");
        }

        // --- AUXILIARES ---
        function toggleMenuGeral() {
            const menu = document.getElementById('menuPrincipal');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }
        function openWin(id) { document.getElementById(id).style.display = 'flex'; }
        function closeWin(id) { document.getElementById(id).style.display = 'none'; }
        function buyPremium() { alert("Voc√™ agora √© PREMIUM!"); }
        function renderGroups() {
            document.getElementById('group-list').innerHTML = `<div class="mat-item" onclick="openWin('win-chat')"><span>üåç Comunidade Global</span><span>üí¨</span></div>`;
        }
    </script>
</body>
</html>
