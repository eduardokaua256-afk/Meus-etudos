<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estudo Social Premium</title>
    <style>
        :root {
            --preto: #000; --branco: #fff; --azul: #1DA1F2; --ouro: #ffd700;
            --chat-bg: #12171e; /* Azul petr√≥leo escuro para n√£o cansar a vista */
            --msg-out: #056162; --msg-in: #262d31;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--preto); color: var(--branco); margin: 0; padding: 0; overflow: hidden; }

        /* HEADER E UI PRINCIPAL */
        header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; background: #000; }
        .dots-btn { font-size: 14px; cursor: pointer; color: #888; border: 1px solid #333; padding: 2px 8px; border-radius: 4px; }

        /* BOT√ÉO FLUTUANTE CRIAR GRUPO */
        #btn-float-create { position: fixed; bottom: 80px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: rgba(29, 161, 242, 0.2); border: 1px solid rgba(255,255,255,0.1); color: white; font-size: 24px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); z-index: 999; }

        /* JANELA CHAT COM AURA PREMIUM */
        .win-chat { display: none; position: fixed; top: 10%; left: 3%; right: 3%; height: 80vh; background: var(--chat-bg); border-radius: 15px; flex-direction: column; z-index: 2000; overflow: hidden; border: 1px solid #333; }
        .aura-premium { border: 2px solid var(--ouro); box-shadow: 0 0 25px rgba(255, 215, 0, 0.5); animation: burnAura 2s infinite alternate; }
        @keyframes burnAura { from { box-shadow: 0 0 10px #ffaa00; } to { box-shadow: 0 0 30px #ffdd00; } }

        /* PERFIL DO GRUPO CENTRALIZADO */
        .g-header-pro { text-align: center; padding: 15px; background: rgba(0,0,0,0.4); border-bottom: 1px solid #333; position: relative; }
        .g-pfp-mid { width: 55px; height: 55px; border-radius: 50%; border: 2px solid var(--azul); margin-bottom: 5px; cursor: pointer; transition: 0.3s; }
        .g-pfp-mid:active { transform: scale(1.1); }
        .owner-tag { color: #ff3e3e; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 3px #000; }

        /* MENSAGENS E REA√á√ïES */
        .chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg-wrap { display: flex; flex-direction: column; position: relative; max-width: 85%; }
        .bubble { padding: 8px 12px; border-radius: 12px; font-size: 14px; color: white; position: relative; cursor: pointer; }
        .reactions-menu { display: none; position: absolute; top: -45px; background: #222; border-radius: 20px; padding: 5px 10px; gap: 10px; z-index: 3000; border: 1px solid #444; }

        /* CALCULADORA FLUTUANTE */
        #calc-win { display: none; position: fixed; top: 100px; left: 50px; width: 190px; background: #111; border-radius: 10px; padding: 10px; z-index: 5000; cursor: move; border: 1px solid #444; box-shadow: 0 10px 30px #000; }
        .calc-disp { width: 100%; background: #000; color: #0f0; border: none; text-align: right; padding: 10px; margin-bottom: 10px; border-radius: 5px; font-family: monospace; font-size: 18px; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .calc-grid button { padding: 10px; border: none; border-radius: 5px; background: #222; color: white; cursor: pointer; }

        /* PERFIL / CONFIGS */
        .pfp-main { width: 70px; height: 70px; border-radius: 50%; border: 3px solid #000; }
        .crown-small { position: absolute; top: -10px; left: 24px; font-size: 18px; display: none; z-index: 5; }
        .last-seen { font-size: 10px; color: #888; margin-top: 2px; }

        /* INPUT RODAP√â */
        .chat-input-bar { background: #1a1e23; padding: 10px; display: flex; align-items: center; gap: 8px; border-top: 1px solid #333; }
        .in-msg { flex: 1; background: #000; border: 1px solid #333; color: white; padding: 10px; border-radius: 20px; outline: none; }

        /* BANNER */
        .banner-box { height: 100px; background: var(--azul); cursor: pointer; overflow: hidden; }
    </style>
</head>
<body onload="loadApp()">

    <header>
        <div onclick="openWin('win-materias')" style="cursor:pointer">
            <strong style="color: var(--azul);">Estudo Social</strong><br>
            <small id="my-id-label">ID: 22</small>
        </div>
        <div class="dots-btn" onclick="openWin('win-profile')">‚ãÆ</div>
    </header>

    <div id="btn-float-create" onclick="openWin('win-create-group')">+</div>

    <div id="win-create-group" class="win-chat" style="background: #fff; color: #000; padding: 20px;">
        <h3>Criar Grupo</h3>
        <input type="text" id="cg-name" placeholder="Nome do Grupo" style="width:95%; padding:10px; margin-bottom:10px; border:1px solid #ddd;">
        <textarea id="cg-desc" placeholder="Descri√ß√£o do grupo..." style="width:95%; padding:10px; margin-bottom:10px; border:1px solid #ddd;"></textarea>
        <button onclick="document.getElementById('in-g-pfp').click()">Escolher Foto</button>
        <button onclick="saveNewGroup()" style="background: var(--azul); color:white; width:100%; padding:15px; margin-top:20px; border:none; border-radius:8px; font-weight:bold;">CRIAR AGORA</button>
        <button onclick="closeWin('win-create-group')" style="width:100%; margin-top:10px; background:none; border:none; color:grey;">Cancelar</button>
    </div>

    <div id="win-chat" class="win-chat">
        <div class="g-header-pro">
            <img id="g-pfp-chat" src="https://via.placeholder.com/60" class="g-pfp-mid" onclick="openWin('win-g-manage')">
            <h4 id="g-name-chat" style="margin: 0; color: white;">Grupo de Estudos</h4>
            <div id="g-status" style="color: var(--azul); font-size: 10px; height: 14px;"></div>
        </div>
        
        <div class="chat-box" id="chat-box"></div>

        <div class="chat-input-bar">
            <button onclick="sendSticker()" style="background:none; border:none; font-size:20px;">üé≠</button>
            <button onclick="document.getElementById('in-chat-img').click()" style="background:none; border:none; font-size:20px;">üñºÔ∏è</button>
            <button id="btn-mic" onmousedown="startAudio()" onmouseup="stopAudio()" ontouchstart="startAudio()" ontouchend="stopAudio()" style="background:none; border:none; color: white; font-size: 20px;">üé§</button>
            <input type="text" id="chat-input" class="in-msg" placeholder="Mensagem..." oninput="isTyping()">
            <button onclick="sendMessage()" style="background:none; border:none; color: var(--azul); font-size: 24px;">‚û°Ô∏è</button>
        </div>
    </div>

    <div id="win-profile" class="win-chat" style="background: #000; color: white;">
        <div class="banner-box" id="u-banner" onclick="document.getElementById('in-banner').click()"></div>
        <div style="padding: 15px; text-align: center; position: relative; margin-top: -40px;">
            <div style="position: relative; width: 70px; margin: 0 auto;">
                <span id="u-crown" class="crown-small">üëë</span>
                <img id="u-pfp" src="https://via.placeholder.com/70" class="pfp-main" onclick="document.getElementById('in-pfp').click()">
            </div>
            <div class="last-seen">visto por √∫ltimo hoje √†s <span id="clock">--:--</span></div>
            
            <div style="margin-top: 15px; text-align: left;">
                <label style="font-size: 12px; color: #888;">NOME (@):</label><br>
                <input type="text" id="u-name" value="@Dono_22" style="width:95%; background:#111; color:white; border:1px solid #333; padding:8px; border-radius:5px;"><br><br>
                <label style="font-size: 12px; color: #888;">BIO:</label><br>
                <textarea id="u-bio" style="width:95%; background:#111; color:white; border:1px solid #333; padding:8px; border-radius:5px;">Dono do Site</textarea>
                <p><strong>Meu ID: 22</strong></p>
                <button onclick="alert('Login Google indispon√≠vel em modo local.')" style="width:100%; padding:10px;">Entrar com conta Google G</button>
            </div>
            <hr style="border-color: #222;">
            <div style="display: flex; justify-content: space-around; font-size: 12px;">
                <span onclick="setStatus('green')" style="color: lime; cursor:pointer;">‚óè Online</span>
                <span onclick="setStatus('red')" style="color: red; cursor:pointer;">‚óè Offline</span>
            </div>
            <br>
            <button onclick="activatePremium()" style="width:100%; background:var(--ouro); color:black; padding:12px; font-weight:bold; border:none; border-radius:8px;">COMPRAR PREMIUM üëë</button>
            <br><br>
            <button onclick="toggleCalc()" style="width: 100%;">Calculadora Flutuante</button>
            <br><br>
            <button onclick="clearMemory()" style="color: red; font-size: 11px; background: none; border: none;">Limpar Cache e Mem√≥ria</button>
        </div>
    </div>

    <div id="calc-win">
        <div id="calc-handle" style="font-size: 9px; color: #666; text-align: center; margin-bottom: 5px; background: #222; border-radius: 3px;">CALC (ARRASTE)</div>
        <input type="text" id="calc-res" class="calc-disp" readonly>
        <div class="calc-grid">
            <button onclick="cIn('7')">7</button><button onclick="cIn('8')">8</button><button onclick="cIn('9')">9</button><button onclick="cIn('/')">/</button>
            <button onclick="cIn('4')">4</button><button onclick="cIn('5')">5</button><button onclick="cIn('6')">6</button><button onclick="cIn('*')">*</button>
            <button onclick="cIn('1')">1</button><button onclick="cIn('2')">2</button><button onclick="cIn('3')">3</button><button onclick="cIn('-')">-</button>
            <button onclick="cIn('0')">0</button><button onclick="cIn('C')">C</button><button onclick="cRes()">=</button><button onclick="cIn('+')">+</button>
        </div>
    </div>

    <div id="win-g-manage" class="win-chat" style="background: #fff; color: #000; padding: 20px;">
        <div style="text-align: center;">
            <img id="g-pfp-manage" src="https://via.placeholder.com/60" style="width:60px; border-radius: 50%;">
            <h3 id="g-name-manage">Grupo</h3>
            <p id="g-desc-manage" style="font-size: 12px; color: #555;">Descri√ß√£o...</p>
        </div>
        <hr>
        <button onclick="addById()">Adicionar por ID ou Usu√°rio</button><br><br>
        <button onclick="groupConfig('adm')">Somente ADMs podem falar</button><br><br>
        <button onclick="groupConfig('lock')">Trancar Grupo</button><br><br>
        <button onclick="alert('Hist√≥rico para novos membros ativado!')">Op√ß√£o: Mem√≥ria Atemporal</button>
        <hr>
        <button onclick="deleteGroup()" style="background: #ff3e3e; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px;">APAGAR GRUPO</button>
        <button onclick="closeWin('win-g-manage')" style="margin-top: 15px; width: 100%;">Fechar</button>
    </div>

    <div id="win-materias" class="win-chat" style="background:#000; padding:20px;">
        <h2 style="color:var(--azul)">Estudos</h2>
        <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
            <button onclick="alert('YouTube: Playlist Matem√°tica Gr√°tis')">Matem√°tica ‚ãÆ</button>
            <button onclick="alert('YouTube: Playlist Ingl√™s Gr√°tis')">Ingl√™s ‚ãÆ</button>
            <button onclick="alert('YouTube: Playlist Hist√≥ria Gr√°tis')">Hist√≥ria ‚ãÆ</button>
            <button onclick="alert('YouTube: Playlist Reda√ß√£o Gr√°tis')">Reda√ß√£o ‚ãÆ</button>
        </div>
        <button onclick="closeWin('win-materias')" style="margin-top:20px;">Voltar</button>
    </div>

    <input type="file" id="in-pfp" hidden onchange="readImg(this, 'u-pfp')">
    <input type="file" id="in-banner" hidden onchange="readImg(this, 'u-banner', true)">
    <input type="file" id="in-g-pfp" hidden onchange="readImg(this, 'g-pfp-chat')">
    <input type="file" id="in-chat-img" hidden onchange="sendImg(this)">

    <div onclick="openWin('win-chat')" style="position:fixed; bottom:20px; right:20px; font-size:45px;">üìñ</div>

    <script>
        let isPremium = false;
        let mediaRecorder;
        let audioChunks = [];
        let typingTimer;

        // SISTEMA DE BANCO DE MENSAGENS (LOCALSTORAGE)
        function loadApp() {
            let saved = JSON.parse(localStorage.getItem('msgs_db') || '[]');
            saved.forEach(m => renderMessage(m));
            document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function saveMsg(m) {
            let saved = JSON.parse(localStorage.getItem('msgs_db') || '[]');
            saved.push(m);
            localStorage.setItem('msgs_db', JSON.stringify(saved));
        }

        function openWin(id) { document.getElementById(id).style.display = 'flex'; }
        function closeWin(id) { document.getElementById(id).style.display = 'none'; }

        // PREMIUM
        function activatePremium() {
            isPremium = true;
            document.getElementById('u-crown').style.display = 'block';
            document.getElementById('win-chat').classList.add('aura-premium');
            alert("üëë Modo Premium Ativado! Aura amarela liberada.");
        }

        // CHAT
        function sendMessage() {
            let input = document.getElementById('chat-input');
            if(!input.value) return;
            let m = { type: 'text', content: input.value, owner: true, id: Date.now() };
            renderMessage(m);
            saveMsg(m);
            input.value = "";
        }

        function renderMessage(m) {
            let box = document.getElementById('chat-box');
            let wrap = document.createElement('div');
            wrap.className = "msg-wrap";
            if(m.owner) wrap.style.alignSelf = "flex-end";
            
            let ownerName = isPremium ? '<span class="owner-tag" style="animation: flicker 0.5s infinite alternate;">Dono #27</span>' : '<span class="owner-tag">Dono #27</span>';

            wrap.innerHTML = `
                <div class="reactions-menu">
                    <span onclick="react(this, '‚ù§Ô∏è')">‚ù§Ô∏è</span><span onclick="react(this, 'üòÇ')">üòÇ</span><span onclick="deleteM(this)">üóëÔ∏è</span><span onclick="alert('Fixado!')">üìå</span>
                </div>
                ${ownerName}
                <div class="bubble" style="background:${m.owner ? 'var(--msg-out)' : 'var(--msg-in)'}" oncontextmenu="showMenu(event)" onlongpress="showMenu(event)">
                    ${m.type === 'img' ? `<img src="${m.content}" style="max-width:200px; border-radius:8px;">` : m.content}
                </div>`;
            
            // Suporte para clique longo
            let pressTimer;
            wrap.addEventListener('touchstart', (e) => pressTimer = setTimeout(() => showMenu(e), 800));
            wrap.addEventListener('touchend', () => clearTimeout(pressTimer));
            wrap.addEventListener('mousedown', (e) => pressTimer = setTimeout(() => showMenu(e), 800));
            wrap.addEventListener('mouseup', () => clearTimeout(pressTimer));

            box.appendChild(wrap);
            box.scrollTop = box.scrollHeight;
        }

        function showMenu(e) {
            e.preventDefault();
            let menu = e.currentTarget.parentElement.querySelector('.reactions-menu');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }

        function deleteM(el) { el.parentElement.parentElement.remove(); }
        function react(el, emo) { el.parentElement.parentElement.querySelector('.bubble').innerHTML += `<small style="font-size:10px; position:absolute; bottom:-5px; right:5px;">${emo}</small>`; el.parentElement.style.display = 'none'; }

        // √ÅUDIO REAL (MICROFONE)
        async function startAudio() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    renderMessage({ type: 'text', content: 'üé§ √Åudio Gravado (Qualidade M√°xima)', owner: true });
                    audioChunks = [];
                };
                mediaRecorder.start();
                document.getElementById('btn-mic').style.color = "red";
                document.getElementById('g-status').innerText = "Dono gravando √°udio...";
            } catch (err) { alert("Acesso ao microfone negado!"); }
        }

        function stopAudio() {
            if(mediaRecorder) {
                mediaRecorder.stop();
                document.getElementById('btn-mic').style.color = "white";
                document.getElementById('g-status').innerText = "";
            }
        }

        // FOTO
        function sendImg(input) {
            if (input.files && input.files[0]) {
                let r = new FileReader();
                r.onload = e => { renderMessage({ type: 'img', content: e.target.result, owner: true }); saveMsg({ type: 'img', content: e.target.result, owner: true }); };
                r.readAsDataURL(input.files[0]);
            }
        }

        // CALCULADORA FLUTUANTE
        let calcWin = document.getElementById('calc-win');
        let calcHandle = document.getElementById('calc-handle');
        calcHandle.onmousedown = function(e) {
            let shiftX = e.clientX - calcWin.getBoundingClientRect().left;
            let shiftY = e.clientY - calcWin.getBoundingClientRect().top;
            function moveAt(pageX, pageY) { calcWin.style.left = pageX - shiftX + 'px'; calcWin.style.top = pageY - shiftY + 'px'; }
            function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
            document.addEventListener('mousemove', onMouseMove);
            document.onmouseup = function() { document.removeEventListener('mousemove', onMouseMove); calcWin.onmouseup = null; };
        };

        function toggleCalc() { calcWin.style.display = calcWin.style.display === 'block' ? 'none' : 'block'; }
        function cIn(v) { let d = document.getElementById('calc-res'); if(v==='C') d.value=''; else d.value+=v; }
        function cRes() { try { let d = document.getElementById('calc-res'); d.value = eval(d.value); } catch { d.value='Erro'; } }

        // GEST√ÉO DO GRUPO
        function saveNewGroup() {
            document.getElementById('g-name-chat').innerText = document.getElementById('cg-name').value + " #27";
            document.getElementById('g-name-manage').innerText = document.getElementById('cg-name').value;
            document.getElementById('g-desc-manage').innerText = document.getElementById('cg-desc').value;
            closeWin('win-create-group');
            openWin('win-chat');
        }

        function groupConfig(tipo) {
            let box = document.getElementById('chat-box');
            let m = tipo === 'lock' ? "O grupo est√° trancado, somente os adm podem remover essa fun√ß√£o." : "Adm Dono #27 alterou as configura√ß√µes para somente adms.";
            box.innerHTML += `<div style="text-align:center; font-size:11px; color:orange; margin:10px;">${m}</div>`;
        }

        function isTyping() {
            document.getElementById('g-status').innerText = "Dono escrevendo...";
            clearTimeout(typingTimer);
            typingTimer = setTimeout(() => document.getElementById('g-status').innerText = "", 1500);
        }

        function setStatus(cor) { document.getElementById('my-id-label').style.color = cor; }
        function clearMemory() { localStorage.removeItem('msgs_db'); location.reload(); }
        function readImg(i, id, isBg = false) { if (i.files && i.files[0]) { let r = new FileReader(); r.onload = e => { if(isBg) document.getElementById(id).style.backgroundImage=`url(${e.target.result})`; else document.getElementById(id).src = e.target.result; }; r.readAsDataURL(i.files[0]); } }
        function sendSticker() { renderMessage({type: 'text', content: 'üé≠ (Figurinha Discord Premium)', owner: true}); }
    </script>
</body>
</html>
