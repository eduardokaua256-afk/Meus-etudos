<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estudo Social - Master Ultra v11</title>
    <style>
        :root {
            --preto: #000000; --azul-chat: #0a192f; --azul-msg: #004d99;
            --verde: #00ff00; --vermelho: #ff0000; --ouro: #ffd700;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--preto); color: white; margin: 0; overflow: hidden; }

        /* HEADER & UI */
        .btn-x-global { position: fixed; top: 10px; right: 10px; background: var(--vermelho); color: white; border: none; border-radius: 5px; width: 28px; height: 28px; cursor: pointer; z-index: 10000; font-weight: bold; }
        .win { display: none; position: fixed; inset: 0; background: var(--preto); flex-direction: column; z-index: 2000; }
        .win-small { height: 70%; top: 15%; border: 1px solid #333; border-radius: 15px; }

        /* PREMIUM & ANIMA√á√ïES */
        @keyframes fire { from { text-shadow: 0 0 5px #ff0; } to { text-shadow: 0 0 20px #f00; } }
        .fire-text { animation: fire 0.5s infinite alternate; color: #ffcc00 !important; }
        .aura-fire { border: 2px solid var(--ouro) !important; box-shadow: 0 0 25px #ffaa00; }
        .premium-text { animation: floatText 2s infinite ease-in-out; }
        @keyframes floatText { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* CHAT DESIGN */
        .chat-container { flex: 1; background: linear-gradient(to bottom, #000, var(--azul-chat)); overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        .bubble { max-width: 75%; padding: 10px; border-radius: 12px; font-size: 13px; position: relative; }
        .b-out { align-self: flex-end; background: var(--azul-msg); }
        .b-in { align-self: flex-start; background: #161b22; }

        /* CALCULADORA FLUTUANTE */
        #calc-floating { display: none; position: fixed; width: 240px; background: #000; border: 1px solid #444; border-radius: 10px; z-index: 9000; cursor: move; padding: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        .calc-disp { width: 100%; background: #000; color: #0f0; border: none; text-align: right; font-size: 22px; padding: 5px; margin-bottom: 5px; }

        /* PESQUISA TRANSPARENTE */
        .search-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(12px); z-index: 9500; align-items: center; justify-content: center; }
        .search-bar { width: 85%; background: transparent; border: none; border-bottom: 3px solid white; color: white; font-size: 28px; text-align: center; outline: none; }

        /* MIDIAS TIPO TELEGRAM */
        .media-bar { display: none; flex-direction: row; background: #111; font-size: 10px; border-bottom: 1px solid #333; }
        .media-bar span { flex: 1; padding: 10px; text-align: center; cursor: pointer; }

        /* FLOATING CALL BLOB */
        #video-blob { display: none; width: 45px; height: 45px; background: #222; border-radius: 50%; border: 2px solid #0f0; align-items: center; justify-content: center; position: absolute; left: 10px; top: -55px; }
    </style>
</head>
<body onload="startup()">

    <div id="home-screen" style="padding: 15px; height: 100vh; overflow-y: auto;">
        <h2 style="color: #1DA1F2;">Estudo Social</h2>
        <p>ID: 22 <span id="home-status" style="color:var(--verde)">‚óè Online</span></p>
        
        <button onclick="openSearch()" style="width:100%; padding:15px; border-radius:25px; background:rgba(255,255,255,0.05); color:white; border:1px solid #333;">üîç Pesquisar na Internet...</button>

        <div id="materias-container" style="margin-top:20px;">
            <h3>Mat√©rias</h3>
            <div id="mat-list"></div>
        </div>

        <div id="group-tabs" style="margin-top:20px;">
            <h3>Grupos Criados</h3>
            <div id="saved-groups"></div>
        </div>

        <button id="btn-create" onclick="openWin('win-create-group')" style="position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; background:rgba(29,161,242,0.2); border:1px solid #1DA1F2; color:white; font-size:30px; backdrop-filter:blur(5px);">+</button>
        <button onclick="openWin('win-profile')" style="position:fixed; bottom:90px; right:20px; width:60px; height:60px; border-radius:50%; background:var(--azul-msg); border:none; color:white;">PERFIL</button>
    </div>

    <div id="win-profile" class="win win-small">
        <button class="btn-x-global" onclick="closeWin('win-profile')">X</button>
        <div id="p-banner" onclick="triggerFile('in-banner')" style="height:100px; background:#111; background-size:cover;"></div>
        <center>
            <div style="position:relative; width:80px; margin-top:-40px;">
                <span id="p-crown" style="position:absolute; top:-25px; left:25%; font-size:35px; display:none;">üëë</span>
                <img id="p-pfp" src="https://via.placeholder.com/80" style="width:80px; height:80px; border-radius:50%; border:3px solid #1DA1F2;" onclick="triggerFile('in-pfp')">
            </div>
            <h3 id="p-display">@Dono_22</h3>
            <div id="p-status" style="color:var(--verde)">‚óè Online</div>
            <small>visto por √∫ltimo hoje √†s <span id="v-time"></span></small>
            <p>ID: 22</p>
            <input type="text" id="p-id-search" placeholder="Buscar ID ou Usu√°rio..." style="width:80%; margin:5px;">
            <button onclick="buyPremium()" style="width:80%; background:var(--ouro); color:black; font-weight:bold; border:none; padding:10px; border-radius:8px;">COMPRAR PREMIUM üëë</button>
            <button onclick="toggleCalc()" style="width:80%; margin-top:5px;">Calculadora Cient√≠fica</button>
            <button onclick="clearSystem()" style="width:80%; margin-top:5px; color:red;">Limpar Cache/Mem√≥ria</button>
        </center>
    </div>

    <div id="win-chat" class="win">
        <button class="btn-x-global" onclick="closeWin('win-chat')">X</button>
        <div id="chat-header" style="text-align:center; padding:10px; border-bottom:1px solid #333;">
            <img id="g-pfp" src="https://via.placeholder.com/60" style="width:60px; height:60px; border-radius:50%; cursor:pointer;" onclick="triggerFile('in-g-pfp')">
            <h4 id="g-name-chat">Grupo</h4>
            <div id="typing-box" style="font-size:10px; color:cyan; height:12px;"></div>
            <button onclick="openWin('win-g-settings')" style="position:absolute; left:15px; top:15px; background:none; border:none; color:white; font-size:20px;">‚öôÔ∏è</button>
        </div>

        <div id="media-tabs-ui" class="media-bar">
            <span onclick="alert('M√≠dias: Fotos/V√≠deos')">M√≠dias</span>
            <span onclick="alert('Arquivos: PDF/Docs')">Arquivos</span>
            <span onclick="alert('Links')">Links</span>
        </div>

        <div class="chat-container" id="chat-box"></div>

        <div style="background:#000; padding:10px; display:flex; align-items:center; gap:8px; position:relative;">
            <div id="video-blob">üìπ</div>
            <button onclick="alert('Dino & Figurinhas Premium!')" style="background:none; border:none; font-size:20px;">üé≠</button>
            <button id="mic-btn" onmousedown="recStart()" onmouseup="recStop()" style="background:none; border:none; color:white; font-size:20px;">üé§</button>
            <input type="text" id="chat-in" placeholder="Mensagem..." oninput="isTyping('write')" style="flex:1; background:#111; border:1px solid #333; color:white; padding:8px; border-radius:20px;">
            <button onclick="sendMsg()" style="background:none; border:none; color:#1DA1F2; font-size:25px;">‚û°Ô∏è</button>
        </div>
    </div>

    <div id="win-g-settings" class="win win-small" style="background:white; color:black;">
        <button class="btn-x-global" onclick="closeWin('win-g-settings')">X</button>
        <div style="padding:20px;">
            <h3>Configura√ß√µes do Grupo</h3>
            <textarea id="g-desc" placeholder="Descri√ß√£o do grupo..." style="width:100%; height:50px;"></textarea>
            <button onclick="openMedia()">Ver M√≠dias/Arquivos/Links</button>
            <button onclick="toggleVideoCall()">Ativar Chamada de V√≠deo?</button>
            <button onclick="setMode('lock')" style="width:100%; margin-top:5px;">Trancar Grupo</button>
            <button onclick="setMode('adm')" style="width:100%; margin-top:5px;">Somente ADM</button>
            <button onclick="deleteGroup()" style="width:100%; background:red; color:white; margin-top:20px;">Apagar Grupo</button>
        </div>
    </div>

    <div id="win-create-group" class="win win-small" style="background:white; color:black;">
        <button class="btn-x-global" onclick="closeWin('win-create-group')">X</button>
        <div style="padding:20px;">
            <h3>Criar Novo Grupo</h3>
            <input type="text" id="cg-name" placeholder="Nome do Grupo" style="width:100%; margin-bottom:10px;">
            <textarea id="cg-desc" placeholder="Descri√ß√£o" style="width:100%; margin-bottom:10px;"></textarea>
            <button onclick="createNewGroup()" style="width:100%; padding:15px; background:var(--azul-msg); color:white; border:none; border-radius:8px;">CRIAR</button>
        </div>
    </div>

    <div id="calc-floating">
        <div style="background:#222; font-size:9px; text-align:center; cursor:move;">CALCULADORA SCI</div>
        <input type="text" id="c-screen" class="calc-disp" readonly>
        <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:4px;">
            <button onclick="cVal('7')">7</button><button onclick="cVal('8')">8</button><button onclick="cVal('9')">9</button><button onclick="cVal('/')">/</button>
            <button onclick="cVal('4')">4</button><button onclick="cVal('5')">5</button><button onclick="cVal('6')">6</button><button onclick="cVal('*')">*</button>
            <button onclick="cVal('1')">1</button><button onclick="cVal('2')">2</button><button onclick="cVal('3')">3</button><button onclick="cVal('-')">-</button>
            <button onclick="cVal('0')">0</button><button onclick="cVal('Math.sqrt(')">‚àö</button><button onclick="cRes()">=</button><button onclick="cVal('+')">+</button>
            <button onclick="cVal('Math.PI')">œÄ</button><button onclick="cVal('**')">^</button><button onclick="cVal('C')" style="color:red">C</button><button onclick="toggleCalc()">X</button>
        </div>
    </div>

    <div id="search-win" class="search-overlay">
        <button class="btn-x-global" onclick="closeWin('search-win')">X</button>
        <input type="text" class="search-bar" placeholder="O que deseja aprender?" onkeypress="doSearch(event)">
    </div>

    <input type="file" id="in-pfp" hidden onchange="readImg(this, 'p-pfp')">
    <input type="file" id="in-banner" hidden onchange="readImg(this, 'p-banner', true)">
    <input type="file" id="in-g-pfp" hidden onchange="readImg(this, 'g-pfp')">

    <script>
        let isPremium = false;
        let mediaRec, chunks = [];
        let typeTimer;

        function startup() {
            document.getElementById('v-time').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            loadSavedMsgs();
            loadSavedGroups();
            renderMaterias();
        }

        function openWin(id) { document.getElementById(id).style.display = 'flex'; }
        function closeWin(id) { document.getElementById(id).style.display = 'none'; }
        function openSearch() { document.getElementById('search-win').style.display = 'flex'; }
        function triggerFile(id) { document.getElementById(id).click(); }

        // MENSAGENS PERSISTENTES
        function sendMsg() {
            let input = document.getElementById('chat-in');
            if(!input.value) return;
            let m = { type: 'text', content: input.value, owner: true, time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) };
            renderMsg(m);
            saveToStorage(m);
            input.value = "";
        }

        function saveToStorage(m) {
            let db = JSON.parse(localStorage.getItem('db_ultra_v11') || '[]');
            db.push(m);
            localStorage.setItem('db_ultra_v11', JSON.stringify(db));
        }

        function loadSavedMsgs() {
            let db = JSON.parse(localStorage.getItem('db_ultra_v11') || '[]');
            db.forEach(m => renderMsg(m));
        }

        function renderMsg(m) {
            let box = document.getElementById('chat-box');
            let div = document.createElement('div');
            div.className = m.owner ? "bubble b-out" : "bubble b-in";
            
            let fundadorTag = isPremium ? '<small class="fire-text">Fundador #27</small><br>' : '<small style="color:orange">Fundador #27</small><br>';
            
            if(m.type === 'audio') {
                div.innerHTML = `${fundadorTag}<audio src="${m.content}" controls style="width:200px;"></audio>`;
            } else if(m.type === 'img') {
                div.innerHTML = `${fundadorTag}<img src="${m.content}" style="max-width:100%; border-radius:8px;">`;
            } else {
                div.innerHTML = `${fundadorTag}${m.content}<span style="font-size:9px; opacity:0.5; float:right; margin: 5px 0 0 8px;">${m.time}</span>`;
            }

            // SEGURAR MENSAGEM (FIXAR, APAGAR, REAGIR)
            let hold;
            div.onmousedown = () => hold = setTimeout(() => {
                let act = prompt("1: Reagir ‚ù§Ô∏è | 2: Apagar | 3: Fixar | 4: Editar");
                if(act == '2') div.remove();
                if(act == '4') div.innerHTML = fundadorTag + prompt("Editar:") + `<span style="font-size:9px; opacity:0.5; float:right;">${m.time}</span>`;
            }, 800);
            div.onmouseup = () => clearTimeout(hold);

            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        // √ÅUDIO REAL
        async function recStart() {
            isTyping('rec');
            let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRec = new MediaRecorder(stream);
            mediaRec.ondataavailable = e => chunks.push(e.data);
            mediaRec.onstop = () => {
                let blob = new Blob(chunks, { type: 'audio/ogg' });
                let reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onloadend = () => {
                    let m = { type: 'audio', content: reader.result, owner: true, time: "Agora" };
                    renderMsg(m);
                    saveToStorage(m);
                };
                chunks = [];
            };
            mediaRec.start();
            document.getElementById('mic-btn').style.color = "red";
        }
        function recStop() {
            mediaRec.stop();
            document.getElementById('mic-btn').style.color = "white";
            document.getElementById('typing-box').innerText = "";
        }

        // STATUS DIGITANDO/GRAVANDO
        function isTyping(mode) {
            let txt = mode === 'write' ? "Lucas est√° escrevendo..." : "Lucas est√° gravando √°udio...";
            document.getElementById('typing-box').innerText = txt;
            clearTimeout(typeTimer);
            typeTimer = setTimeout(() => document.getElementById('typing-box').innerText = "", 1500);
        }

        // CALCULADORA ARRAST√ÅVEL
        function toggleCalc() { let c = document.getElementById('calc-floating'); c.style.display = c.style.display === 'block' ? 'none' : 'block'; }
        function cVal(v) { document.getElementById('c-screen').value += v; }
        function cRes() { try { let s = document.getElementById('c-screen'); s.value = eval(s.value); } catch { s.value = "Erro"; } }

        const calc = document.getElementById('calc-floating');
        let drag = false;
        calc.onmousedown = () => drag = true;
        document.onmousemove = (e) => { if(drag) { calc.style.left = e.pageX - 120 + 'px'; calc.style.top = e.pageY - 50 + 'px'; } };
        document.onmouseup = () => drag = false;

        // SISTEMA DE GRUPOS
        function createNewGroup() {
            let n = document.getElementById('cg-name').value;
            let db = JSON.parse(localStorage.getItem('groups_v11') || '[]');
            db.push({ name: n, id: Math.floor(Math.random()*1000) });
            localStorage.setItem('groups_v11', JSON.stringify(db));
            loadSavedGroups();
            closeWin('win-create-group');
        }
        function loadSavedGroups() {
            let db = JSON.parse(localStorage.getItem('groups_v11') || '[]');
            let cont = document.getElementById('saved-groups');
            cont.innerHTML = "";
            db.forEach(g => {
                cont.innerHTML += `<div onclick="enterGroup('${g.name}')" style="background:#0a192f; padding:15px; border-radius:10px; margin-bottom:5px;">üë• ${g.name}</div>`;
            });
        }
        function enterGroup(n) { document.getElementById('g-name-chat').innerText = n; openWin('win-chat'); }

        // MAT√âRIAS
        function renderMaterias() {
            let mats = ['Matem√°tica', 'Ingl√™s', 'Hist√≥ria', 'Geografia', 'Reda√ß√£o'];
            let html = "";
            mats.forEach(m => {
                html += `<div style="background:#111; padding:12px; margin-bottom:5px; display:flex; justify-content:space-between; border-radius:8px;">
                    <span>${m}</span> <button onclick="alert('Playlist YouTube Gr√°tis Ativada!')">‚ãÆ</button>
                </div>`;
            });
            document.getElementById('mat-list').innerHTML = html;
        }

        // PREMIUM
        function buyPremium() {
            isPremium = true;
            document.getElementById('p-crown').style.display = 'block';
            document.getElementById('win-profile').classList.add('aura-fire');
            document.getElementById('win-chat').classList.add('aura-fire');
            alert("üëë Premium Ativado! Aura e nomes flamejantes liberados!");
        }

        function toggleVideoCall() {
            let v = document.getElementById('video-blob');
            v.style.display = v.style.display === 'flex' ? 'none' : 'flex';
            alert("Op√ß√£o Chamada de V√≠deo alterada!");
        }

        function openMedia() { document.getElementById('media-tabs-ui').style.display = 'flex'; }
        function doSearch(e) { if(e.key === 'Enter') window.open("https://www.google.com/search?q=" + e.target.value); }
        function readImg(i, id, bg=false) {
            if(i.files[0]) {
                let r = new FileReader();
                r.onload = e => { 
                    if(bg) document.getElementById(id).style.backgroundImage = `url(${e.target.result})`;
                    else document.getElementById(id).src = e.target.result;
                };
                r.readAsDataURL(i.files[0]);
            }
        }
    </script>
</body>
</html>
