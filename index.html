<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estudo Social - Master Premium</title>
    <style>
        :root {
            --preto: #000000; --azul: #003366; --azul-claro: #1DA1F2;
            --msg-out: #004d99; --msg-in: #1a1a1a; --ouro: #ffd700; --vermelho: #ff0000;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--preto); color: white; margin: 0; overflow: hidden; }
        
        /* ANIMA√á√ïES PREMIUM */
        @keyframes fogo { from { text-shadow: 0 0 5px #ff0, 0 0 10px #f60; } to { text-shadow: 0 0 10px #f60, 0 0 20px #f00; } }
        .fire-text { animation: fogo 0.5s infinite alternate; color: #ffcc00 !important; font-weight: bold; }
        .aura-premium { border: 2px solid var(--ouro) !important; box-shadow: 0 0 15px var(--ouro); }

        /* HEADER E UI */
        .btn-x { background: var(--vermelho); color: white; border: none; border-radius: 5px; width: 25px; height: 25px; cursor: pointer; float: right; }
        .win { display: none; position: fixed; top: 5%; left: 5%; width: 90%; height: 85%; background: var(--preto); border-radius: 15px; border: 1px solid #333; flex-direction: column; z-index: 2000; }
        .small-win { height: 60%; top: 20%; }

        /* CHAT E MENSAGENS */
        .chat-box { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; background: linear-gradient(to bottom, #000, #001a33); }
        .msg { max-width: 75%; padding: 8px; border-radius: 12px; font-size: 13px; position: relative; }
        .msg-own { align-self: flex-end; background: var(--msg-out); }
        .msg-guest { align-self: flex-start; background: var(--msg-in); }
        .msg-time { font-size: 9px; opacity: 0.6; display: block; text-align: right; }
        
        /* CALCULADORA CIENT√çFICA */
        #calc { display: none; position: fixed; width: 280px; background: #111; border: 1px solid #444; border-radius: 10px; padding: 10px; z-index: 5000; cursor: move; }
        .calc-screen { width: 100%; height: 40px; background: #000; color: #0f0; text-align: right; font-size: 20px; border: none; margin-bottom: 10px; }
        .calc-btns { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .calc-btns button { padding: 10px; background: #222; color: white; border: none; border-radius: 5px; }

        /* PESQUISA TRANSPARENTE */
        #search-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 9000; justify-content: center; align-items: center; }
        .search-in { width: 80%; background: transparent; border: none; border-bottom: 2px solid var(--azul-claro); color: white; font-size: 24px; text-align: center; outline: none; }

        /* PERFIL */
        .pfp-container { position: relative; width: 80px; margin: 0 auto; }
        .crown { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 30px; z-index: 10; display: none; }
        .pfp { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--azul-claro); object-fit: cover; cursor: pointer; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }

        /* FOOTER */
        .footer-chat { background: #000; padding: 10px; display: flex; align-items: center; gap: 5px; }
        .footer-chat input { flex: 1; background: #1a1a1a; border: 1px solid #333; color: white; padding: 8px; border-radius: 20px; }
    </style>
</head>
<body onload="init()">

    <div id="main-ui" style="padding: 15px;">
        <header style="display: flex; justify-content: space-between;">
            <div onclick="openWin('win-materias')"><strong>Estudo Social</strong><br><small>ID: 22</small></div>
            <div onclick="openWin('win-profile')" style="cursor:pointer">‚ãÆ</div>
        </header>
        
        <div style="margin-top:20px;">
            <button onclick="openSearch()" style="width:100%; padding:12px; background:rgba(255,255,255,0.1); border:none; border-radius:20px; color:white;">üîç Pesquisar na Internet...</button>
        </div>

        <div id="groups-list" style="margin-top:20px;">
            <p style="font-size: 12px; color: #888;">GRUPOS CRIADOS</p>
            <div id="saved-groups"></div>
        </div>
    </div>

    <div id="win-profile" class="win small-win">
        <div style="padding:10px;">
            <button class="btn-x" onclick="closeWin('win-profile')">X</button>
            <div class="pfp-container">
                <span id="u-crown" class="crown">üëë</span>
                <img id="u-pfp" src="https://via.placeholder.com/80" class="pfp" onclick="clickPfp()">
            </div>
            <center>
                <div id="u-status">Visto por √∫ltimo hoje √†s <span id="visto-time">--:--</span></div>
                <div style="margin-top:5px;"><span class="status-dot" style="background:lime"></span> Online</div>
                <p>@Dono_22 | ID: 22</p>
            </center>
            <div style="padding:0 15px;">
                <input type="text" id="u-name" placeholder="Mudar Nome" style="width:100%; margin-bottom:5px;">
                <textarea id="u-bio" placeholder="Mudar Bio" style="width:100%;"></textarea>
                <button onclick="window.location.href='https://accounts.google.com/'" style="width:100%; margin-top:10px;">Login Google</button>
                <button onclick="buyPremium()" style="width:100%; margin-top:10px; background:var(--ouro); color:black;">COMPRAR PREMIUM</button>
                <button onclick="toggleCalc()" style="width:100%; margin-top:5px;">Calculadora Cient√≠fica</button>
                <button onclick="localStorage.clear(); location.reload();" style="width:100%; margin-top:5px; color:red;">Limpar Mem√≥ria</button>
            </div>
        </div>
    </div>

    <div id="win-chat" class="win">
        <div id="chat-header" style="padding:10px; text-align:center; border-bottom:1px solid #333;">
            <button class="btn-x" onclick="closeWin('win-chat')">X</button>
            <img id="g-pfp" src="https://via.placeholder.com/50" style="width:50px; border-radius:50%;" onclick="clickPfp()">
            <h4 id="g-title" style="margin:5px 0;">Grupo</h4>
            <small id="typing-status" style="color:var(--azul-claro); height:12px; display:block;"></small>
        </div>

        <div class="chat-box" id="box"></div>

        <div class="footer-chat">
            <button onclick="sendDiscord()" style="background:none; border:none; font-size:20px;">üé≠</button>
            <button id="btn-mic" onmousedown="recStart()" onmouseup="recStop()" style="background:none; border:none; color:white; font-size:20px;">üé§</button>
            <input type="text" id="msg-in" placeholder="Mensagem..." oninput="isTyping()">
            <button onclick="sendMsg()" style="color:var(--azul-claro); background:none; border:none; font-size:24px;">‚û°Ô∏è</button>
        </div>
    </div>

    <div id="win-create" class="win small-win">
        <div style="padding:20px;">
            <button class="btn-x" onclick="closeWin('win-create')">X</button>
            <h3>Novo Grupo</h3>
            <input type="text" id="cg-name" placeholder="Nome do Grupo" style="width:100%; margin-bottom:10px;">
            <textarea id="cg-desc" placeholder="Descri√ß√£o" style="width:100%; margin-bottom:10px;"></textarea>
            <input type="text" id="cg-members" placeholder="Adicionar ID de Membros (ex: 22, 105)" style="width:100%;">
            <button onclick="saveGroup()" style="width:100%; margin-top:20px; padding:10px; background:var(--azul-claro); color:white; border:none; border-radius:5px;">CRIAR</button>
        </div>
    </div>

    <div id="search-overlay">
        <input type="text" class="search-in" id="search-q" placeholder="Pesquisar..." onkeypress="doSearch(event)">
        <button class="btn-x" onclick="document.getElementById('search-overlay').style.display='none'" style="position:fixed; top:20px; right:20px;">X</button>
    </div>

    <div id="calc">
        <div style="text-align:center; font-size:10px; color:#888; background:#222; cursor:move;">CALCULADORA CIENT√çFICA</div>
        <input type="text" id="c-res" class="calc-screen" readonly>
        <div class="calc-btns">
            <button onclick="cIn('7')">7</button><button onclick="cIn('8')">8</button><button onclick="cIn('9')">9</button><button onclick="cIn('/')">/</button>
            <button onclick="cIn('4')">4</button><button onclick="cIn('5')">5</button><button onclick="cIn('6')">6</button><button onclick="cIn('*')">*</button>
            <button onclick="cIn('1')">1</button><button onclick="cIn('2')">2</button><button onclick="cIn('3')">3</button><button onclick="cIn('-')">-</button>
            <button onclick="cIn('0')">0</button><button onclick="cIn('Math.sqrt(')">‚àö</button><button onclick="cRes()">=</button><button onclick="cIn('+')">+</button>
            <button onclick="cIn('Math.PI')">œÄ</button><button onclick="cIn('**')">^</button><button onclick="cIn('C')" style="color:red">C</button><button onclick="toggleCalc()">X</button>
        </div>
    </div>

    <div id="btn-float" onclick="openWin('win-create')" style="position:fixed; bottom:20px; right:20px; width:50px; height:50px; background:rgba(29,161,242,0.3); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px; border:1px solid #1DA1F2; z-index:1000;">+</div>

    <input type="file" id="file-in" hidden onchange="loadFile(this)">

    <script>
        let isPremium = false;
        let recorder, chunks = [];
        let typingTime;

        function init() {
            document.getElementById('visto-time').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            loadGroups();
            renderSavedMsgs();
        }

        function openWin(id) { document.getElementById(id).style.display = 'flex'; }
        function closeWin(id) { document.getElementById(id).style.display = 'none'; }
        function openSearch() { document.getElementById('search-overlay').style.display = 'flex'; }

        // MENSAGENS E PERSIST√äNCIA
        function sendMsg() {
            let inp = document.getElementById('msg-in');
            if(!inp.value) return;
            let m = { type: 'text', content: inp.value, time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), owner: true };
            renderMsg(m);
            saveMsg(m);
            inp.value = "";
        }

        function saveMsg(m) {
            let db = JSON.parse(localStorage.getItem('chat_db') || '[]');
            db.push(m);
            localStorage.setItem('chat_db', JSON.stringify(db));
        }

        function renderSavedMsgs() {
            let db = JSON.parse(localStorage.getItem('chat_db') || '[]');
            db.forEach(m => renderMsg(m));
        }

        function renderMsg(m) {
            let box = document.getElementById('box');
            let div = document.createElement('div');
            div.className = m.owner ? "msg msg-own" : "msg msg-guest";
            
            let nameTag = `<small class="${isPremium ? 'fire-text' : ''}" style="color:orange">Dono #27</small><br>`;
            
            if(m.type === 'audio') {
                div.innerHTML = `${nameTag}<audio src="${m.content}" controls style="width:180px;"></audio>`;
            } else if(m.type === 'img') {
                div.innerHTML = `${nameTag}<img src="${m.content}" style="max-width:100%; border-radius:10px;">`;
            } else {
                div.innerHTML = `${nameTag}${m.content}<span class="msg-time">${m.time}</span>`;
            }

            // SEGURAR PARA REAGIR/EDITAR
            let timer;
            div.onmousedown = () => timer = setTimeout(() => {
                let act = prompt("1: Reagir | 2: Apagar | 3: Fixar | 4: Editar");
                if(act == '2') div.remove();
                if(act == '4') div.innerHTML = nameTag + prompt("Novo texto:") + `<span class="msg-time">${m.time}</span>`;
            }, 800);
            div.onmouseup = () => clearTimeout(timer);

            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        // √ÅUDIO REAL
        async function recStart() {
            let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            recorder = new MediaRecorder(stream);
            recorder.ondataavailable = e => chunks.push(e.data);
            recorder.onstop = () => {
                let blob = new Blob(chunks, { type: 'audio/ogg' });
                let url = URL.createObjectURL(blob);
                let m = { type: 'audio', content: url, owner: true };
                renderMsg(m);
                saveMsg(m);
                chunks = [];
            };
            recorder.start();
            document.getElementById('btn-mic').style.color = "red";
            document.getElementById('typing-status').innerText = "Gravando √°udio...";
        }
        function recStop() {
            recorder.stop();
            document.getElementById('btn-mic').style.color = "white";
            document.getElementById('typing-status').innerText = "";
        }

        // CALCULADORA
        function toggleCalc() { let c = document.getElementById('calc'); c.style.display = c.style.display === 'block' ? 'none' : 'block'; }
        function cIn(v) { let s = document.getElementById('c-res'); if(v==='C') s.value=''; else s.value+=v; }
        function cRes() { try { let s = document.getElementById('c-res'); s.value = eval(s.value); } catch { s.value='Erro'; } }

        // GEST√ÉO
        function buyPremium() {
            isPremium = true;
            document.getElementById('u-crown').style.display = 'block';
            document.getElementById('win-chat').classList.add('aura-premium');
            alert("üëë Premium Ativado! Aura de fogo e nomes flamejantes liberados.");
        }

        function clickPfp() { document.getElementById('file-in').click(); }
        function loadFile(i) {
            let fr = new FileReader();
            fr.onload = e => {
                let m = { type: 'img', content: e.target.result, owner: true };
                renderMsg(m);
                saveMsg(m);
            };
            fr.readAsDataURL(i.files[0]);
        }

        function saveGroup() {
            let name = document.getElementById('cg-name').value;
            let div = document.createElement('div');
            div.innerHTML = `<button onclick="openChat('${name}')" style="width:100%; margin-top:5px; background:var(--azul); border:none; color:white; padding:10px; border-radius:10px;">${name} #ID_GRUPO</button>`;
            document.getElementById('saved-groups').appendChild(div);
            closeWin('win-create');
        }

        function doSearch(e) {
            if(e.key === 'Enter') {
                window.open('https://www.google.com/search?q=' + document.getElementById('search-q').value);
            }
        }

        function isTyping() {
            document.getElementById('typing-status').innerText = "Dono escrevendo...";
            clearTimeout(typingTime);
            typingTime = setTimeout(() => document.getElementById('typing-status').innerText = "", 1000);
        }
    </script>
</body>
</html>
