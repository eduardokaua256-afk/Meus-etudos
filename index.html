<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estudo Social Ultimate</title>
    <style>
        :root { 
            --preto: #000000; --azul-escuro: #0a192f; --azul-msg: #112240; 
            --branco: #ffffff; --ouro: #ffd700; --vermelho: #ff4d4d;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--preto); color: var(--branco); margin: 0; padding: 0; overflow: hidden; user-select: none; }

        /* HEADER */
        header { padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1a1a1a; }
        .dots-btn { font-size: 14px; cursor: pointer; color: #888; }

        /* BOT√ÉO VOLTAR GLOBAL */
        .btn-back { position: absolute; top: 10px; right: 10px; background: var(--vermelho); color: white; border: none; border-radius: 5px; width: 30px; height: 30px; cursor: pointer; z-index: 5000; font-weight: bold; }

        /* MAT√âRIAS */
        #home-screen { padding: 15px; height: 90vh; overflow-y: auto; }
        .materia-card { background: var(--azul-escuro); padding: 20px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #1e2d44; }

        /* JANELAS SISTEMA */
        .win { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--preto); z-index: 2000; flex-direction: column; }
        .win-content { flex: 1; overflow-y: auto; position: relative; }

        /* CHAT PRETO E AZUL */
        #win-chat { background: linear-gradient(to bottom, #000000, #0a192f); }
        .chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg-wrap { max-width: 80%; position: relative; padding: 10px; border-radius: 12px; font-size: 14px; }
        .msg-own { align-self: flex-end; background: var(--azul-msg); border: 1px solid #233554; }
        .msg-guest { align-self: flex-start; background: #1a1a1a; }
        
        /* PREMIUM: FOGO E AURA */
        .fire-text { animation: fireAnim 0.7s infinite alternate; font-weight: bold; }
        @keyframes fireAnim { from { color: #ffcc00; text-shadow: 0 0 5px #ff6600; } to { color: #ff6600; text-shadow: 0 0 15px #ff0000; } }
        .aura-premium { box-shadow: 0 0 20px var(--ouro); border: 1px solid var(--ouro) !important; }

        /* CALCULADORA CIENT√çFICA ARRAST√ÅVEL */
        #calc-win { 
            display: none; position: fixed; top: 100px; left: 20px; width: 260px; 
            background: #111; border: 1px solid #444; border-radius: 10px; z-index: 6000; cursor: move;
            transition: transform 0.2s;
        }
        .calc-screen { width: 90%; background: #000; color: #0f0; text-align: right; padding: 15px; font-family: monospace; font-size: 20px; border: none; margin: 5px; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; padding: 10px; }
        .calc-grid button { padding: 12px; background: #222; color: white; border: none; border-radius: 5px; font-size: 14px; }

        /* PESQUISA TRANSPARENTE */
        #search-win { background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); }
        .search-bar { width: 80%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 15px; border-radius: 30px; color: white; font-size: 18px; outline: none; }

        /* PERFIL / COROA */
        .pfp-wrap { position: relative; width: 100px; margin: 20px auto; }
        .pfp-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--azul-escuro); object-fit: cover; }
        .crown-master { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 35px; display: none; }

        /* FOOTER CHAT */
        .chat-footer { background: #000; padding: 10px; display: flex; align-items: center; gap: 8px; }
        .btn-action { background: none; border: none; font-size: 20px; color: white; cursor: pointer; }

        /* FLOATING CREATE BUTTON */
        #btn-float { position: fixed; bottom: 30px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: rgba(29, 161, 242, 0.2); border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 30px; backdrop-filter: blur(5px); z-index: 1000; }
    </style>
</head>
<body onload="initApp()">

    <div id="home-screen">
        <header>
            <div><strong>Estudo Social</strong><br><small>ID: 22</small></div>
            <div class="dots-btn" onclick="openWin('win-profile')">‚ãÆ</div>
        </header>
        <h3 style="margin-top: 20px;">Minhas Mat√©rias</h3>
        <div id="lista-materias">
            <div class="materia-card"><span>üìê Matem√°tica</span> <button class="dots-btn" onclick="alert('Playlist: YouTube Matem√°tica Gr√°tis')">‚ãÆ</button></div>
            <div class="materia-card"><span>üá∫üá∏ Ingl√™s</span> <button class="dots-btn" onclick="alert('Playlist: YouTube Ingl√™s Gr√°tis')">‚ãÆ</button></div>
            <div class="materia-card"><span>üìú Hist√≥ria</span> <button class="dots-btn" onclick="alert('Playlist: YouTube Hist√≥ria Gr√°tis')">‚ãÆ</button></div>
            <div class="materia-card"><span>üåç Geografia</span> <button class="dots-btn" onclick="alert('Playlist: YouTube Geografia Gr√°tis')">‚ãÆ</button></div>
            <div class="materia-card"><span>üá™üá∏ Espanhol</span> <button class="dots-btn" onclick="alert('Playlist: YouTube Espanhol Gr√°tis')">‚ãÆ</button></div>
            <div class="materia-card"><span>‚úçÔ∏è Reda√ß√£o</span> <button class="dots-btn" onclick="alert('Playlist: YouTube Reda√ß√£o Gr√°tis')">‚ãÆ</button></div>
        </div>
        <button onclick="openWin('win-search')" style="width:100%; padding:15px; background:rgba(255,255,255,0.1); border:none; border-radius:10px; color:white;">üîç Pesquisar Conte√∫dos</button>
    </div>

    <div id="btn-float" onclick="openWin('win-create')">+</div>

    <div id="win-profile" class="win">
        <button class="btn-back" onclick="closeWin('win-profile')">X</button>
        <div class="win-content" style="padding: 20px; text-align: center;">
            <div class="banner-box" id="u-banner" onclick="document.getElementById('in-banner').click()" style="height:120px; background:var(--azul-escuro); border-radius:10px;"></div>
            <div class="pfp-wrap">
                <span id="u-crown" class="crown-master">üëë</span>
                <img id="u-pfp" src="https://via.placeholder.com/100" class="pfp-img" onclick="document.getElementById('in-pfp').click()">
            </div>
            <div id="u-status-dot" style="color: lime; font-size: 12px;">‚óè Online</div>
            <div class="last-seen" style="font-size: 10px; color: #888;">visto por √∫ltimo hoje √†s <span id="u-time">10:00</span></div>
            
            <div style="text-align: left; margin-top: 20px;">
                <label>Mudar Nome (@):</label><br>
                <input type="text" id="u-at" value="@Dono_22" style="width:100%; background:#111; color:white; border:1px solid #333; padding:10px; border-radius:5px;"><br><br>
                <label>Mudar Bio:</label><br>
                <textarea id="u-bio" style="width:100%; background:#111; color:white; border:1px solid #333; padding:10px; border-radius:5px;">Criador do Site</textarea>
                <p><strong>Meu ID: 22</strong></p>
                <button onclick="window.location.href='https://accounts.google.com/'" style="width:100%; padding:12px; background:white; color:black; border-radius:5px; font-weight:bold;">Entrar com Google G</button>
            </div>
            <hr style="border-color: #222; margin: 20px 0;">
            <button onclick="activatePremium()" style="width:100%; padding:15px; background:var(--ouro); color:black; font-weight:bold; border:none; border-radius:10px;">COMPRAR PREMIUM üëë</button>
            <br><br>
            <button onclick="toggleWidget('calc-win')">üßÆ Calculadora Cient√≠fica</button><br><br>
            <button onclick="alert('Cache limpo!')" style="color:red; background:none; border:none;">Limpar Cache/Mem√≥ria</button>
            <br><br>
            <button onclick="alert('Comunidade em breve...')">üë• Comunidade</button>
        </div>
    </div>

    <div id="win-create" class="win" style="background: white; color: black;">
        <button class="btn-back" onclick="closeWin('win-create')">X</button>
        <div class="win-content" style="padding: 30px;">
            <h3>Novo Grupo</h3>
            <input type="text" id="new-g-name" placeholder="Nome do Grupo" style="width:100%; padding:12px; margin-bottom:15px;">
            <textarea id="new-g-desc" placeholder="Descri√ß√£o do Grupo" style="width:100%; padding:12px; margin-bottom:15px;"></textarea>
            <p>ID do Grupo: #27 (Autom√°tico)</p>
            <button onclick="createG()" style="width:100%; padding:15px; background:var(--azul-escuro); color:white; border:none; border-radius:10px;">CRIAR GRUPO</button>
        </div>
    </div>

    <div id="win-chat" class="win">
        <button class="btn-back" onclick="closeWin('win-chat')">X</button>
        <div class="win-content" style="display: flex; flex-direction: column;">
            <div style="text-align: center; padding: 15px; border-bottom: 1px solid #1a1a1a;">
                <img id="g-pfp" src="https://via.placeholder.com/60" style="width:60px; height:60px; border-radius:50%;" onclick="document.getElementById('in-g-pfp').click()">
                <h4 id="g-title" style="margin: 5px 0;">Grupo de Estudos</h4>
                <small id="g-status-text" style="color: var(--azul); font-size: 10px;"></small>
            </div>
            <div class="chat-box" id="chat-box"></div>
            <div class="chat-footer">
                <button class="btn-action" onclick="sendSticker()">üé≠</button>
                <button class="btn-action" onclick="document.getElementById('in-chat-img').click()">üñºÔ∏è</button>
                <button id="btn-mic" class="btn-action" onmousedown="startRec()" onmouseup="stopRec()" ontouchstart="startRec()" ontouchend="stopRec()">üé§</button>
                <input type="text" id="chat-in" class="in-msg" placeholder="Mensagem..." oninput="isTyping()">
                <button class="btn-action" onclick="sendMsg()" style="color:var(--azul)">‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <div id="win-search" class="win" style="display:none; justify-content:center; align-items:center;">
        <button class="btn-back" onclick="closeWin('win-search')">X</button>
        <input type="text" class="search-bar" placeholder="Pesquisar no Google Estudos...">
    </div>

    <div id="calc-win">
        <div id="calc-header" style="padding:5px; background:#222; font-size:10px; text-align:center;">DRAG TO MOVE</div>
        <input type="text" id="calc-res" class="calc-screen" readonly>
        <div class="calc-grid">
            <button onclick="cVal('7')">7</button><button onclick="cVal('8')">8</button><button onclick="cVal('9')">9</button><button onclick="cVal('/')">/</button>
            <button onclick="cVal('4')">4</button><button onclick="cVal('5')">5</button><button onclick="cVal('6')">6</button><button onclick="cVal('*')">*</button>
            <button onclick="cVal('1')">1</button><button onclick="cVal('2')">2</button><button onclick="cVal('3')">3</button><button onclick="cVal('-')">-</button>
            <button onclick="cVal('0')">0</button><button onclick="cVal('.')">.</button><button onclick="cRes()">=</button><button onclick="cVal('+')">+</button>
            <button onclick="cVal('Math.sqrt(')">‚àö</button><button onclick="cVal('Math.PI')">œÄ</button><button onclick="cVal('**')">^</button><button onclick="cVal('C')" style="color:red">C</button>
        </div>
        <button onclick="toggleWidget('calc-win')" style="width:100%; background:none; color:grey; font-size:10px; border:none; padding:5px;">FECHAR</button>
    </div>

    <input type="file" id="in-pfp" hidden onchange="readImg(this, 'u-pfp')">
    <input type="file" id="in-banner" hidden onchange="readImg(this, 'u-banner', true)">
    <input type="file" id="in-g-pfp" hidden onchange="readImg(this, 'g-pfp')">
    <input type="file" id="in-chat-img" hidden onchange="sendImg(this)">

    <script>
        let isPremium = false;
        let typingTimer;
        let mediaRecorder;
        let audioChunks = [];

        // INICIALIZA√á√ÉO E PERSIST√äNCIA (LOCALSTORAGE)
        function initApp() {
            let history = JSON.parse(localStorage.getItem('chat_v7') || '[]');
            history.forEach(m => renderMsg(m));
            document.getElementById('u-time').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        }

        function saveMsg(m) {
            let history = JSON.parse(localStorage.getItem('chat_v7') || '[]');
            history.push(m);
            localStorage.setItem('chat_v7', JSON.stringify(history));
        }

        function openWin(id) { document.getElementById(id).style.display = 'flex'; }
        function closeWin(id) { document.getElementById(id).style.display = 'none'; }
        
        function toggleWidget(id) {
            let el = document.getElementById(id);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        function activatePremium() {
            isPremium = true;
            document.getElementById('u-crown').style.display = 'block';
            document.getElementById('win-chat').classList.add('aura-premium');
            alert("üëë Premium Ativado! Aura amarela e coroa liberadas.");
        }

        // CHAT L√ìGICA
        function sendMsg() {
            let input = document.getElementById('chat-in');
            if(!input.value) return;
            let m = { type: 'text', content: input.value, owner: true, name: "@Dono_22 #27" };
            renderMsg(m);
            saveMsg(m);
            input.value = "";
        }

        function renderMsg(m) {
            let box = document.getElementById('chat-box');
            let div = document.createElement('div');
            div.className = m.owner ? "msg-wrap msg-own" : "msg-wrap msg-guest";
            
            let nameStyle = isPremium ? "fire-text" : "color:var(--azul); font-weight:bold;";
            div.innerHTML = `
                <small class="${nameStyle}">${m.name}</small><br>
                ${m.type === 'img' ? `<img src="${m.content}" style="max-width:100%; border-radius:8px;">` : m.content}
            `;
            
            // REA√á√ïES AO SEGURAR
            let press;
            div.addEventListener('touchstart', () => press = setTimeout(() => alert("Reagir | Apagar | Fixar"), 800));
            div.addEventListener('touchend', () => clearTimeout(press));
            
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        // √ÅUDIO REAL (SEGURAR)
        async function startRec() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    renderMsg({ type: 'text', content: 'üé§ √Åudio Gravado (Qualidade HD)', owner: true, name: "@Dono_22 #27" });
                };
                mediaRecorder.start();
                document.getElementById('btn-mic').style.color = "red";
                document.getElementById('g-status-text').innerText = "Dono gravando √°udio...";
            } catch (err) { alert("Microfone n√£o autorizado."); }
        }

        function stopRec() {
            if(mediaRecorder) {
                mediaRecorder.stop();
                document.getElementById('btn-mic').style.color = "white";
                document.getElementById('g-status-text').innerText = "";
            }
        }

        function isTyping() {
            document.getElementById('g-status-text').innerText = "Dono est√° escrevendo...";
            clearTimeout(typingTimer);
            typingTimer = setTimeout(() => document.getElementById('g-status-text').innerText = "", 1500);
        }

        function createG() {
            let name = document.getElementById('new-g-name').value;
            document.getElementById('g-title').innerText = name + " #27";
            closeWin('win-create');
            openWin('win-chat');
        }

        // CALCULADORA ARRAST√ÅVEL
        const calc = document.getElementById('calc-win');
        let isDragging = false;
        calc.onmousedown = (e) => { if(e.target.id === 'calc-header') isDragging = true; };
        document.onmousemove = (e) => {
            if(isDragging) {
                calc.style.left = e.pageX - 130 + 'px';
                calc.style.top = e.pageY - 20 + 'px';
            }
        };
        document.onmouseup = () => isDragging = false;

        function cVal(v) { let r = document.getElementById('calc-res'); if(v==='C') r.value=""; else r.value+=v; }
        function cRes() { try { let r = document.getElementById('calc-res'); r.value = eval(r.value); } catch { r.value="Erro"; } }

        // UTILIT√ÅRIOS IMAGEM
        function readImg(i, id, isBg=false) {
            if (i.files && i.files[0]) {
                let r = new FileReader();
                r.onload = e => { if(isBg) document.getElementById(id).style.backgroundImage=`url(${e.target.result})`; else document.getElementById(id).src=e.target.result; };
                r.readAsDataURL(i.files[0]);
            }
        }
        function sendImg(i) {
            if (i.files && i.files[0]) {
                let r = new FileReader();
                r.onload = e => { renderMsg({type:'img', content: e.target.result, owner:true, name:"@Dono_22 #27"}); };
                r.readAsDataURL(i.files[0]);
            }
        }
        function sendSticker() { renderMsg({type:'text', content:'üé≠ (Figurinha Discord Premium)', owner:true, name:"@Dono_22 #27"}); }
    </script>
</body>
</html>
