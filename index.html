<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estudo Social - Master v12</title>
    <style>
        :root {
            --preto: #000000; --azul-profundo: #001220; --azul-brilhante: #1DA1F2;
            --msg-out: #003a6b; --msg-in: #161b22; --ouro: #ffd700; --vermelho: #ff3b3b;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--preto); color: white; margin: 0; overflow: hidden; }

        /* ANIMA√á√ïES */
        @keyframes fogo { from { text-shadow: 0 0 8px #ff0, 0 0 12px #f60; } to { text-shadow: 0 0 12px #f60, 0 0 25px #f00; } }
        .fire-text { animation: fogo 0.4s infinite alternate; color: #ffcc00 !important; }
        .aura-fire { border: 2px solid var(--ouro) !important; box-shadow: 0 0 20px #ffaa00; }
        .id-owner { animation: fogo 0.5s infinite alternate; color: #1DA1F2 !important; font-weight: bold; }

        /* UI GERAL */
        .btn-x { position: absolute; top: 10px; right: 10px; background: var(--vermelho); color: white; border: none; border-radius: 5px; width: 30px; height: 30px; cursor: pointer; z-index: 10000; font-weight: bold; }
        .win { display: none; position: fixed; inset: 0; background: var(--preto); flex-direction: column; z-index: 2000; }
        .win-small { height: 80%; top: 10%; border-radius: 20px; border: 1px solid #333; }

        /* CHAT */
        .chat-header { display: flex; flex-direction: column; align-items: center; padding: 10px; border-bottom: 1px solid #333; position: relative; }
        .chat-flow { flex: 1; overflow-y: auto; background: linear-gradient(to bottom, #000, #001a33); padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 80%; padding: 10px; border-radius: 15px; font-size: 14px; position: relative; }
        .b-out { align-self: flex-end; background: var(--msg-out); }
        .b-in { align-self: flex-start; background: var(--msg-in); }

        /* CALCULADORA FLUTUANTE */
        #calc-sci { display: none; position: fixed; width: 220px; background: #000; border: 1px solid #444; border-radius: 10px; z-index: 9000; cursor: move; padding: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .calc-display { width: 100%; height: 40px; background: #111; color: #0f0; text-align: right; border: none; font-size: 18px; margin-bottom: 5px; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; }
        .calc-grid button { padding: 10px; background: #222; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; }

        /* PESQUISA TRANSPARENTE */
        .search-win { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(15px); z-index: 9500; align-items: center; justify-content: center; }
        .search-input { width: 80%; background: transparent; border: none; border-bottom: 2px solid white; color: white; font-size: 24px; text-align: center; outline: none; }

        /* BOTOES FLUTUANTES */
        .float-create { position: fixed; bottom: 20px; right: 20px; width: 55px; height: 55px; background: rgba(29,161,242,0.2); border: 1px solid var(--azul-brilhante); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; z-index: 1000; backdrop-filter: blur(5px); }
        .float-search-user { position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px; background: #111; border: 1px solid #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1000; }

        /* BANNER */
        .banner-perfil { width: 100%; height: 120px; background-color: #111; background-size: cover; background-position: center; cursor: pointer; }
        .pfp-main { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--azul-brilhante); margin-top: -40px; cursor: pointer; object-fit: cover; }
        .crown-small { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 25px; display: none; }
    </style>
</head>
<body onload="initApp()">

    <div id="home" style="padding: 15px; height: 100vh; overflow-y: auto;">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h2 style="margin:0; color:var(--azul-brilhante)">Estudos Sociais</h2>
            <button onclick="openWin('win-add-materia')" style="background:none; border:1px solid #333; color:white; padding:5px 10px; border-radius:15px; font-size:12px;">+ Adicionar Mat√©ria</button>
            <div onclick="openWin('win-profile')" style="cursor:pointer; font-size:24px;">‚ãÆ</div>
        </div>
        
        <p style="font-size:12px; color:#888;">ID: <span class="id-owner">22</span></p>

        <div style="margin: 15px 0;">
            <button onclick="openSearch()" style="width:100%; padding:12px; background:rgba(255,255,255,0.05); border:1px solid #333; border-radius:20px; color:white;">üîç Pesquisar na Internet...</button>
        </div>

        <h4 style="font-size:13px; color:var(--azul-brilhante); margin-bottom:10px;">MAT√âRIAS</h4>
        <div id="materias-list"></div>

        <h4 style="font-size:13px; color:var(--azul-brilhante); margin: 20px 0 10px 0;">GRUPOS SALVOS</h4>
        <div id="saved-groups-list"></div>

        <div class="float-create" onclick="openWin('win-create-group')">+</div>
        <div class="float-search-user" onclick="openWin('win-find-user')">üë§</div>
    </div>

    <div id="win-profile" class="win win-small">
        <button class="btn-x" onclick="closeWin('win-profile')">X</button>
        <div id="p-banner" class="banner-perfil" onclick="triggerFile('in-banner')"></div>
        <center>
            <div style="position:relative; width:80px;">
                <span id="p-crown" class="crown-small">üëë</span>
                <img id="p-img" src="https://via.placeholder.com/80" class="pfp-main" onclick="triggerFile('in-pfp')">
            </div>
            <h3 id="p-nome" style="margin:10px 0;">@Dono</h3>
            <div id="p-status">‚óè <span id="status-txt">Online</span></div>
            <small style="color:#888">visto por √∫ltimo <span id="visto-hora">--:--</span></small>
            <div style="margin-top:15px; padding:0 20px;">
                <input type="text" id="change-name" placeholder="Mudar @nome" style="width:100%; margin-bottom:5px;">
                <input type="text" id="change-bio" placeholder="Mudar Bio" style="width:100%; margin-bottom:5px;">
                <p style="font-size:11px;">SEU ID: <span class="id-owner">22</span></p>
                <button onclick="buyPremium()" style="width:100%; background:var(--ouro); color:black; font-weight:bold; border:none; padding:10px; border-radius:5px;">COMPRAR PREMIUM üëë</button>
                <button onclick="toggleCalc()" style="width:100%; margin-top:5px;">Calculadora</button>
                <button onclick="localStorage.clear(); location.reload();" style="color:red; background:none; border:none; margin-top:10px;">Limpar Cache</button>
            </div>
        </center>
    </div>

    <div id="win-chat" class="win">
        <button class="btn-x" onclick="closeWin('win-chat')">X</button>
        <div class="chat-header">
            <img id="g-pfp" src="https://via.placeholder.com/60" style="width:60px; height:60px; border-radius:50%; object-fit:cover;" onclick="triggerFile('in-g-pfp')">
            <h4 id="g-display-name" style="margin:5px 0;">Grupo</h4>
            <div id="typing-status" style="font-size:10px; color:var(--azul-brilhante); height:12px;"></div>
            <button onclick="openWin('win-g-settings')" style="position:absolute; left:15px; top:15px; background:none; border:none; color:white; font-size:20px;">‚öôÔ∏è</button>
        </div>
        <div class="chat-flow" id="chat-box"></div>
        <div id="video-bubble" style="display:none; position:absolute; bottom:70px; left:20px; background:#222; padding:10px; border-radius:50%; border:1px solid #0f0;">üìπ</div>
        <div style="background:#000; padding:10px; display:flex; gap:8px; align-items:center;">
            <button onclick="sendDiscordSticker()" style="background:none; border:none; font-size:20px;">üé≠</button>
            <button onmousedown="startRec()" onmouseup="stopRec()" id="mic-btn" style="background:none; border:none; color:white; font-size:20px;">üé§</button>
            <input type="text" id="msg-in" placeholder="Mensagem..." oninput="handleTyping()" style="flex:1; background:#111; border:1px solid #333; color:white; padding:8px; border-radius:20px;">
            <button onclick="sendMsg()" style="background:none; border:none; color:var(--azul-brilhante); font-size:24px;">‚û°Ô∏è</button>
        </div>
    </div>

    <div id="calc-sci">
        <input type="text" id="c-disp" class="calc-display" readonly>
        <div class="calc-grid">
            <button onclick="cVal('7')">7</button><button onclick="cVal('8')">8</button><button onclick="cVal('9')">9</button><button onclick="cVal('/')">/</button>
            <button onclick="cVal('4')">4</button><button onclick="cVal('5')">5</button><button onclick="cVal('6')">6</button><button onclick="cVal('*')">*</button>
            <button onclick="cVal('1')">1</button><button onclick="cVal('2')">2</button><button onclick="cVal('3')">3</button><button onclick="cVal('-')">-</button>
            <button onclick="cVal('0')">0</button><button onclick="cVal('Math.sqrt(')">‚àö</button><button onclick="cExec()">=</button><button onclick="cVal('+')">+</button>
            <button onclick="cVal('Math.PI')">œÄ</button><button onclick="cVal('**')">^</button><button onclick="cVal('C')" style="color:red">C</button><button onclick="toggleCalc()">X</button>
        </div>
    </div>

    <div id="search-win" class="search-win">
        <button class="btn-x" onclick="closeWin('search-win')">X</button>
        <input type="text" id="sq" class="search-input" placeholder="O que deseja pesquisar?" onkeypress="doSearch(event)">
    </div>

    <div id="win-create-group" class="win win-small" style="background:white; color:black;">
        <button class="btn-x" onclick="closeWin('win-create-group')">X</button>
        <div style="padding:20px;">
            <h3>Novo Grupo</h3>
            <input type="text" id="cg-name" placeholder="Nome do Grupo" style="width:100%; margin-bottom:10px;">
            <textarea id="cg-desc" placeholder="Descri√ß√£o" style="width:100%; margin-bottom:10px;"></textarea>
            <button onclick="saveGroup()" style="width:100%; padding:15px; background:var(--azul-brilhante); color:white; border:none; border-radius:10px;">CRIAR GRUPO</button>
        </div>
    </div>

    <div id="win-g-settings" class="win win-small" style="background:white; color:black;">
        <button class="btn-x" onclick="closeWin('win-g-settings')">X</button>
        <div style="padding:20px; overflow-y:auto; height:100%;">
            <h3>Configura√ß√µes</h3>
            <p id="g-info-desc">Descri√ß√£o: Carregando...</p>
            <hr>
            <button onclick="toggleGMode('lock')">üîí Trancar Grupo</button>
            <button onclick="toggleGMode('adm')">üë§ S√≥ ADM manda msg</button>
            <button onclick="toggleGMode('video')">üìπ Ativar Chamada de V√≠deo</button>
            <hr>
            <h4>M√≠dias</h4>
            <div style="display:flex; gap:5px;">
                <button onclick="alert('M√≠dias: Fotos/V√≠deos')">Fotos</button>
                <button onclick="alert('Arquivos: PDF')">PDFs</button>
                <button onclick="alert('Links')">Links</button>
            </div>
            <button onclick="deleteCurrentGroup()" style="background:red; color:white; margin-top:30px; width:100%;">APAGAR GRUPO</button>
        </div>
    </div>

    <input type="file" id="in-pfp" hidden onchange="readImg(this, 'p-img', 'pfp')">
    <input type="file" id="in-banner" hidden onchange="readImg(this, 'p-banner', 'banner')">
    <input type="file" id="in-g-pfp" hidden onchange="readImg(this, 'g-pfp', 'gpfp')">

    <script>
        let isPremium = false;
        let activeGroupId = null;
        let mediaRec, chunks = [];
        let typingTimer;

        const materiasBase = [
            {n: 'Matem√°tica', l: 'https://youtube.com/playlist?list=PL83s8LGM84J4mRCdgGKJaZh8KWFU7GgcO'},
            {n: 'Ingl√™s', l: 'https://youtube.com/playlist?list=PLZ65xj2SRHQB0T2GGk-R7bYxorKUkcyoj'},
            {n: 'Hist√≥ria', l: 'https://youtube.com/playlist?list=PLGCGbN9NWTZBAYWoI5-afZG8bZgIzBoNs'},
            {n: 'Geografia', l: 'https://youtube.com/playlist?list=PLNM2T4DNzmq7p-TtQPn3vjNU9t8M0Arxc'},
            {n: 'Reda√ß√£o', l: 'https://youtube.com/playlist?list=PLPwuAOl5BHi8UTmce6l7kWwDVj2oMYPv2'}
        ];

        function initApp() {
            document.getElementById('visto-hora').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            renderMaterias();
            renderGroups();
            // Carregar fotos salvas
            if(localStorage.getItem('user_pfp')) document.getElementById('p-img').src = localStorage.getItem('user_pfp');
            if(localStorage.getItem('user_banner')) document.getElementById('p-banner').style.backgroundImage = `url(${localStorage.getItem('user_banner')})`;
        }

        function openWin(id) { document.getElementById(id).style.display = 'flex'; }
        function closeWin(id) { document.getElementById(id).style.display = 'none'; }
        function openSearch() { document.getElementById('search-win').style.display = 'flex'; }
        function triggerFile(id) { document.getElementById(id).click(); }

        // MATERIAS
        function renderMaterias() {
            let container = document.getElementById('materias-list');
            container.innerHTML = "";
            let custom = JSON.parse(localStorage.getItem('custom_mats') || '[]');
            [...materiasBase, ...custom].forEach(m => {
                container.innerHTML += `
                <div style="background:#111; padding:12px; margin-bottom:5px; border-radius:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>${m.n}</span>
                    <button onclick="window.open('${m.l}')" style="background:none; border:none; color:white; font-size:18px;">‚ãÆ</button>
                </div>`;
            });
        }

        // GRUPOS
        function saveGroup() {
            let name = document.getElementById('cg-name').value;
            let desc = document.getElementById('cg-desc').value;
            if(!name) return;
            let db = JSON.parse(localStorage.getItem('groups_v12') || '[]');
            let newG = { id: Date.now(), name: name, desc: desc, msgs: [], premium: isPremium };
            db.push(newG);
            localStorage.setItem('groups_v12', JSON.stringify(db));
            renderGroups();
            closeWin('win-create-group');
        }

        function renderGroups() {
            let container = document.getElementById('saved-groups-list');
            container.innerHTML = "";
            let db = JSON.parse(localStorage.getItem('groups_v12') || '[]');
            db.forEach(g => {
                container.innerHTML += `<div onclick="openChat(${g.id})" style="background:var(--azul-profundo); padding:15px; border-radius:12px; margin-bottom:8px; border:1px solid #1a2a3a;">üë• ${g.name}</div>`;
            });
        }

        function openChat(id) {
            activeGroupId = id;
            let db = JSON.parse(localStorage.getItem('groups_v12') || '[]');
            let g = db.find(x => x.id === id);
            document.getElementById('g-display-name').innerText = g.name;
            document.getElementById('g-info-desc').innerText = "Descri√ß√£o: " + (g.desc || "Sem descri√ß√£o");
            renderMessages();
            openWin('win-chat');
        }

        // CHAT ENGINE
        function sendMsg() {
            let input = document.getElementById('msg-in');
            if(!input.value) return;
            let db = JSON.parse(localStorage.getItem('groups_v12') || '[]');
            let gIndex = db.findIndex(x => x.id === activeGroupId);
            let m = { 
                type: 'text', 
                text: input.value, 
                user: "@Dono", 
                id: 22, 
                time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) 
            };
            db[gIndex].msgs.push(m);
            localStorage.setItem('groups_v12', JSON.stringify(db));
            renderMessages();
            input.value = "";
            stopTyping();
        }

        function renderMessages() {
            let box = document.getElementById('chat-box');
            box.innerHTML = "";
            let db = JSON.parse(localStorage.getItem('groups_v12') || '[]');
            let g = db.find(x => x.id === activeGroupId);
            
            g.msgs.forEach((m, index) => {
                let div = document.createElement('div');
                div.className = m.id == 22 ? "bubble b-out" : "bubble b-in";
                
                // Hierarquia de nomes
                let tag = "";
                if(m.id == 22) tag = `<small class="id-owner">${m.user} #22</small><br>`;
                else if(m.role == 'adm') tag = `<small style="color:white">${m.user} #99 ‚öñÔ∏è</small><br>`;
                else tag = `<small style="color:orange">${m.user} #27</small><br>`;

                if(isPremium) tag = `<small class="fire-text">${m.user} #27</small><br>`;

                div.innerHTML = `${tag}${m.text}<span style="font-size:9px; opacity:0.5; float:right; margin:5px 0 0 8px;">${m.time}</span>`;
                
                // Segurar mensagem
                let timer;
                div.onmousedown = () => timer = setTimeout(() => {
                    let op = prompt("1: Reagir ‚ù§Ô∏è | 2: Apagar | 3: Fixar | 4: Editar");
                    if(op == '2') { g.msgs.splice(index, 1); localStorage.setItem('groups_v12', JSON.stringify(db)); renderMessages(); }
                    if(op == '3') alert("Mensagem Fixada!");
                }, 800);
                div.onmouseup = () => clearTimeout(timer);

                box.appendChild(div);
            });
            box.scrollTop = box.scrollHeight;
        }

        // AUDIO
        async function startRec() {
            document.getElementById('typing-status').innerText = "@Dono est√° gravando √°udio...";
            let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRec = new MediaRecorder(stream);
            mediaRec.ondataavailable = e => chunks.push(e.data);
            mediaRec.onstop = () => {
                let blob = new Blob(chunks, { type: 'audio/ogg' });
                let reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onloadend = () => {
                    let db = JSON.parse(localStorage.getItem('groups_v12') || '[]');
                    let gIndex = db.findIndex(x => x.id === activeGroupId);
                    db[gIndex].msgs.push({ type: 'audio', text: `<audio src="${reader.result}" controls style="width:180px;"></audio>`, id: 22, time: "Agora" });
                    localStorage.setItem('groups_v12', JSON.stringify(db));
                    renderMessages();
                };
                chunks = [];
            };
            mediaRec.start();
        }
        function stopRec() { mediaRec.stop(); document.getElementById('typing-status').innerText = ""; }

        function handleTyping() {
            document.getElementById('typing-status').innerText = "@Dono est√° escrevendo...";
            clearTimeout(typingTimer);
            typingTimer = setTimeout(stopTyping, 2000);
        }
        function stopTyping() { document.getElementById('typing-status').innerText = ""; }

        // CALCULADORA
        function toggleCalc() { let c = document.getElementById('calc-sci'); c.style.display = c.style.display === 'block' ? 'none' : 'block'; }
        function cVal(v) { let d = document.getElementById('c-disp'); if(v==='C') d.value=''; else d.value+=v; }
        function cExec() { try { let d = document.getElementById('c-disp'); d.value = eval(d.value); } catch { d.value='Erro'; } }

        const calc = document.getElementById('calc-sci');
        let drag = false;
        calc.onmousedown = () => drag = true;
        document.onmousemove = (e) => { if(drag) { calc.style.left = e.pageX - 110 + 'px'; calc.style.top = e.pageY - 50 + 'px'; } };
        document.onmouseup = () => drag = false;

        // MEDIA
        function readImg(input, id, type) {
            if(input.files[0]) {
                let r = new FileReader();
                r.onload = e => {
                    if(type === 'banner') {
                        document.getElementById(id).style.backgroundImage = `url(${e.target.result})`;
                        localStorage.setItem('user_banner', e.target.result);
                    } else {
                        document.getElementById(id).src = e.target.result;
                        if(type === 'pfp') localStorage.setItem('user_pfp', e.target.result);
                    }
                };
                r.readAsDataURL(input.files[0]);
            }
        }

        function buyPremium() {
            isPremium = true;
            document.getElementById('p-crown').style.display = 'block';
            document.getElementById('win-profile').classList.add('aura-fire');
            alert("üëë Premium Ativado! Tudo em chamas agora.");
        }

        function toggleGMode(mode) {
            if(mode === 'video') document.getElementById('video-bubble').style.display = 'block';
            alert("Modo " + mode + " ativado pelo ADM!");
        }

        function doSearch(e) { if(e.key === 'Enter') window.open("https://www.google.com/search?q=" + e.target.value); }
    </script>
</body>
</html>
